<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezervacija</title>
    <link rel="stylesheet" type="text/css" href="styles/rezervacija.css">
</head>

<body>
    
    <div class="container">
        <div class="header">
            <div class="step-info" id="step-info">Korak 1 od 8</div>
            
            <button class="next-btn" id="next-btn" onclick="nextStep()">SLJEDEĆI KORAK</button>
       </div>
       

        <div class="steps">
            <hr>
            <!-- Step 1 -->
            <div class="step active" id="step1">
                <h1 id="step1Title">VELIČINA GRUPE</h1>
                <div class="options">
                    <button class="option-btn" id="parovi" onclick="selectOption('Za parove')">
                        <img src="imgs/reservation/tura/buttons/couple.png" alt="Za parove" />
                    </button>
                    <button class="option-btn" id="grupa" onclick="selectOption('Grupa 3-5')">
                        <img src="imgs/reservation/tura/buttons/group.png" alt="Grupa 3-5" />
                    </button>
                    <button class="option-btn" id="teambuilding" onclick="selectOption('Teambuilding')">
                        <img src="imgs/reservation/tura/buttons/teambuilding.png" alt="Teambuilding" />
                    </button>
                </div>
                <span class="selected-option" id="selected-option"></span>
            </div>
            

            <!-- Step 2 -->
            <div class="step" id="step2">
                <h1 id="step2Title">DULJINA TURE</h1>
                <div class="options">
                    <button class="option-btn" id="kratka" onclick="selectOption('Kratka')">
                        <img src="imgs/reservation/tura/buttons/short.png" alt="Kratka" />
                    </button>
                    <button class="option-btn" id="srednja" onclick="selectOption('Srednja')">
                        <img src="imgs/reservation/tura/buttons/medium.png" alt="Srednja" />
                    </button>
                    <button class="option-btn" id="duga" onclick="selectOption('Duga')">
                        <img src="imgs/reservation/tura/buttons/long.png" alt="Duga" />
                    </button>
                </div>
                <span class="selected-option" id="selected-option2"></span>
            </div>

            <!-- Step 3 -->
            <div class="step" id="step3">
                <div class="right">
                    <h1>TURE</h1>
                    <div id="tura-buttons">
                        <!-- Buttons for tours will be dynamically generated here -->
                    </div>
                </div>
                <div class="left">
                    <div class="tura-description" id="tura-description">
                        <!-- Selected tour information will be displayed here -->
                        <div class="tura-info-container">
                            <div class="tura-image">
                                <img id="tura-image" src="" alt="" />
                            </div>
                            <div class="tura-details">
                                <strong id="tura-name"></strong>
                                <p id="tura-description-text"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            

          <!-- Step 4 -->
            <div class="step" id="step4">
                <h1 id = "step4Title">DATUM I VRIJEME</h1>
                <span id = "selected-time-date" style = "margin-bottom: 2%;"></span>
                <div class="date-time-picker">
                    <!-- Date Selection -->
                    <div id="date-selection" class="date-selection">
                        <h5 style = "text-align: left;">Izaberite datum</h5>
                        <input type="date" id="reservation-date" class="date-input" onchange="selectDate()">
                    </div>
                    <span id ="placeholder-span" style = "opacity: 60%;">Izaberite prvo datum</span>
                    <!-- Time Selection (initially hidden) -->
                    <div id="time-selection" class="time-selection">
                        <h5 style = "text-align: left; margin-bottom: 2%;">Izaberite vrijeme</h5>
                        <div id="time-buttons-container"></div>
                    </div>
                </div>
            </div>
        




            <!-- Step 5 -->
            <div class="step" id="step5">
                <div class="right">
                    <h1>VODIĆI</h1>
                    <div id="vodic-buttons">
                        <!-- Buttons for guides will be dynamically generated here -->
                    </div>
                </div>
                <div class="left">
                    <div class="vodic-description" id="vodic-description">
                        <div class="vodic-info-container">
                            <div class="vodic-image">
                                <img id="vodic-image" src="" alt="" />
                            </div>
                            <div class="vodic-details">
                                <strong id="vodic-name"></strong>
                                <strong id ="vodic-br-tura"></strong>
                                <strong id = "vodic-tel"></strong>
                                <p id="vodic-description-text"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 6 -->
            <div class="step" id="step6">
                <h1 id = "step6Title">ODABERITE LJUBIMCA</h1>
                <div class="options">
                    <button class="option-btn" id="svinja" onclick="selectOption('Svinja')">
                        <img src="imgs/reservation/zivotinja/buttons/pig.png" alt="Svinja" style="transform: scaleX(-1); object-fit: contain;"/>
                    </button>
                    <button class="option-btn" id="pas" onclick="selectOption('Pas')">
                        <img src="imgs/reservation/zivotinja/buttons/cartoon-dog-sniffing-vector-5167949-removebg-preview.png" alt="Pas" style = "object-fit: contain;"/>
                    </button>
                </div>
                <span class="selected-option" id="selected-option3"></span>
            </div>

            <!-- Step 7 -->
            <div class="step" id="step7">
                <div class="right">
                    <h1>LJUBIMCI</h1>
                    <div id="zivotinja-buttons">
                        <!-- Buttons for animals will be dynamically generated here -->
                    </div>
                </div>
                <div class="left">
                    <div class="zivotinja-description" id="zivotinja-description">
                        <div class="zivotinja-info-container">
                            <div class="zivotinja-image">
                                <img id="zivotinja-image" src="" alt="" />
                            </div>
                            <div class="zivotinja-details">
                                <strong id="zivotinja-name"></strong>
                                <p id="zivotinja-description-text"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 8 -->
            <div class="step" id="step8">
                <h1>PPREGLED REZERVACIJE</h1>
                <div class = "allItems">
                    <div id="summary" class="summary">
                        <p><strong style = "font-size: 16px; color: #FF5B5B; padding: 0px;">Veličina grupe</strong><br><span id="summary-group-size"></span></p>
                        <p><strong style = "font-size: 16px; color: #FF5B5B; padding: 0px;">Tura</strong><br><span id="summary-tour"></span></p>
                        <p><strong style = "font-size: 16px; color: #FF5B5B; padding: 0px;">Datum rezervacije</strong><br><span id="summary-date"></span></p>
                        <p><strong style = "font-size: 16px; color: #FF5B5B; padding: 0px;">Vrijeme</strong><br><span id="summary-time"></span></p>
                        <p><strong style = "font-size: 16px; color: #FF5B5B; padding: 0px;">Vodic</strong><br> <span id="summary-guide"></span></p>
                        <p><strong style = "font-size: 16px; color: #FF5B5B; padding: 0px;">Ljubimac</strong><br> <span id="summary-animal"></span></p>
                        <p><strong style = "font-size: 16px; color: #FF5B5B; padding: 0px;">Cijena</strong><br> <span id="summary-price"></span></p>
                        <div id = "s8-btn-container">
                            <button class="save-btn" id="save-btn" onclick="saveReservation()">Save Reservation</button>
                            <button class="restart-btn" id="restart-btn" onclick = "resetForm()">Restart</button>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <img src="imgs/reservation/decoration/mushroom.gif" alt="Your GIF" id="bottom-right-gif">
    <img src="imgs/reservation/decoration/pig.gif" alt="Your GIF" id="top-left-gif">

    <script type="module">
        import service from './scripts/service.js'; 

        window.currentStep = 1;
        const totalSteps = 8;
        window.selectedOption = '';
        window.groupSize = '';
        window.tourLength = '';
        window.tourId = '';
        window.selectedDate = ''; // Initialize variable to store selected date
        window.selectedGuide = ''; // Initialize variable to store selected guide
        window.selectedPet = ''; // Initialize variable to store selected pet
        window.reservation;
        window.routeTime;
        window.selectedTime;

        function showButtons(step) {
            if (step === 1) {
                setTimeout(() => document.getElementById('parovi').classList.add('visible'), 500);
                setTimeout(() => document.getElementById('grupa').classList.add('visible'), 1000);
                setTimeout(() => document.getElementById('teambuilding').classList.add('visible'), 1500);
            } else if (step === 2) {
                setTimeout(() => document.getElementById('kratka').classList.add('visible'), 500);
                setTimeout(() => document.getElementById('srednja').classList.add('visible'), 1000);
                setTimeout(() => document.getElementById('duga').classList.add('visible'), 1500);
            } else if (step === 3) {
                fetchTours(); // Call function to fetch tours on step 3
            } else if (step === 4) {
                // Any additional logic for step 4 if needed
            } else if (step === 5) {
                fetchVodici(); // Fetch guides on step 5
            } else if (step === 6) {
                // Show buttons for selecting pets in Step 6
                setTimeout(() => document.getElementById('pas').classList.add('visible'), 500);
                setTimeout(() => document.getElementById('svinja').classList.add('visible'), 1000);
            }else if (step === 7) {
                fetchZivotinje(); // Fetch animals on step 7
            }
        }

        function selectOption(option) {
            // Deselect all buttons
            document.querySelectorAll('.option-btn').forEach(function(button) {
                button.classList.remove('selected');
            });

            // Highlight the selected button
            document.querySelector(`.option-btn[onclick="selectOption('${option}')"]`).classList.add('selected');

            // Store the selected option globally (if required for other steps)
            window.selectedOption = option;

            // Show Next button

            setTimeout(() => {
                document.getElementById('next-btn').style.display = "block";
                document.getElementById('next-btn').style.opacity = 0; // Initially set opacity to 0 for fade-in effect
                document.getElementById('next-btn').style.transition = "opacity 1s ease"; // Smooth fade-in transition for imag
    
                // Trigger the fade-in effect after a delay
                setTimeout(() => {
                    document.getElementById('next-btn').style.opacity = 1; // Fade in the image by changing opacity
                }, 10);
            }, 50);

            

            // Update the span for the selected option, if it exists
            if(window.currentStep === 1){
                const selectedOptionSpan = document.getElementById('selected-option');
                if (selectedOptionSpan) {
                    selectedOptionSpan.textContent = `${option}`;
                }
            }
            else if(window.currentStep === 2){
                const selectedOptionSpan = document.getElementById('selected-option2');
                if (selectedOptionSpan) {
                    selectedOptionSpan.textContent = `${option}`;
                }
            }
            else if(window.currentStep === 6){
                const selectedOptionSpan = document.getElementById('selected-option3');
                if (selectedOptionSpan) {
                    selectedOptionSpan.textContent = `${option}`;
                }
            }
            
        }


        function nextStep() {
            if (window.selectedOption || window.currentStep === 4 || window.currentStep === 5 || window.currentStep === 6) { // Allow moving to step 4, 5, and 6 without selection
                document.getElementById('next-btn').style.display = 'none';

                
                switch (window.currentStep) {
                    case 1:
                        window.groupSize = window.selectedOption;
                        console.log("1. Untar switcha: " + window.groupSize);
                        break;
                    case 2:
                        window.tourLength = window.selectedOption;
                        console.log("2. Untar switcha: " + window.tourLength);
                        break;
                    case 3:
                        window.tourId = window.selectedOption;
                        console.log("3. Untar switcha: " + window.tourId);
                        break;
                    case 4:
                        window.selectedDate = document.getElementById('reservation-date').value;
                        window.routeTime = window.selectedTime;
                        console.log("4. Untar switcha: " + window.selectedDate + "\nVrijeme: " + window.routeTime);
                        break;
                    case 5:
                        window.selectedGuide = window.selectedOption;
                        console.log("5. Untar switcha: " + window.selectedGuide.imePrezime);
                        break;
                    case 6:
                        window.selectedPet = window.selectedOption;
                        console.log("6. Untar switcha: " + window.selectedPet);
                        break;
                    case 7:
                        window.selectedAnimal = window.selectedOption;
                        console.log("7. Untar switcha: " + window.selectedAnimal);
                        buildReservation();
                        break;
                    default:
                        console.log("Error");
                }

                //console.log(window.selectedOption);
                window.selectedOption = '';

                // Hide all option buttons
                document.querySelectorAll('.option-btn').forEach(function(button) {
                    button.classList.remove('visible');
                });

                const currentStepElement = document.getElementById(`step${window.currentStep}`);
                currentStepElement.classList.remove('active');

                window.currentStep++;
                const nextStepElement = document.getElementById(`step${window.currentStep}`);
                nextStepElement.classList.add('active');

                document.getElementById('step-info').innerText = `Korak ${window.currentStep} od 8`;

                // Show buttons for the next step
                showButtons(window.currentStep);
            }
        }

        async function saveReservation() {
            await service.addZakazaneTure(window.reservation);
            alert("Reservation saved successfully!"); // Placeholder alert for now
            window.location.href = "index.html";
        }

        async function buildReservation(){
            
            let cijena = 0;

            switch(window.groupSize){
                case "Za parove":
                    cijena += 20;
                    break;
                case "Grupa 3-5":
                    cijena += 50;
                    break;
                case "Teambuilding":
                    cijena += 100;
                    break;
                default:
                    console.log("Error");
            }

            switch(window.tourLength){
                case "Kratka":
                    cijena += 100;
                    break;
                case "Srednja":
                    cijena += 150;
                    break;
                case "Duga":
                    cijena += 200;
                    break;
                default:
                    console.log("Error");
            }
            
            const user = await service.getKorisnikByUsername(localStorage.getItem('username'));
            
            window.reservation = {
                tura: {id: window.tourId.id},
                korisnik: {id: user.id},
                vodic: {id: window.selectedGuide.id},
                zivotinja: {id: window.selectedAnimal.id},
                datum: window.selectedDate,
                vrijeme_ture: window.routeTime,
                velicina_grupe: window.groupSize,
                cijena_ture: cijena
            }

            showDetailsOfReservation();
        }

        function showDetailsOfReservation() {
    // Get elements
    const groupSizeElement = document.getElementById('summary-group-size');
    const tourElement = document.getElementById('summary-tour');
    const dateElement = document.getElementById('summary-date');
    const timeElement = document.getElementById('summary-time');
    const guideElement = document.getElementById('summary-guide');
    const animalElement = document.getElementById('summary-animal');
    const priceElement = document.getElementById('summary-price');
    const btnContainer = document.getElementById('s8-btn-container'); // New container for buttons

    // Hide the elements initially
    groupSizeElement.style.display = 'none';
    tourElement.style.display = 'none';
    dateElement.style.display = 'none';
    timeElement.style.display = 'none';
    guideElement.style.display = 'none';
    animalElement.style.display = 'none';
    priceElement.style.display = 'none';
    btnContainer.style.display = 'none'; // Hide button container initially

    // Set content for each element
    setTimeout(() => {
        groupSizeElement.innerText = window.groupSize;
        groupSizeElement.style.display = "block"; // Show group size
        groupSizeElement.style.opacity = 0; // Initially set opacity to 0
        groupSizeElement.style.transition = "opacity 1s ease"; // Smooth transition for opacity
        setTimeout(() => { groupSizeElement.style.opacity = 1; }, 10); // Fade in the group size

        tourElement.innerText = window.tourId ? window.tourId.ime : '';
        tourElement.style.display = "block"; // Show tour
        tourElement.style.opacity = 0; // Initially set opacity to 0
        tourElement.style.transition = "opacity 1s ease"; // Smooth transition for opacity
        setTimeout(() => { tourElement.style.opacity = 1; }, 200); // Fade in the tour

        dateElement.innerText = window.selectedDate;
        dateElement.style.display = "block"; // Show date
        dateElement.style.opacity = 0; // Initially set opacity to 0
        dateElement.style.transition = "opacity 1s ease"; // Smooth transition for opacity
        setTimeout(() => { dateElement.style.opacity = 1; }, 400); // Fade in the date

        timeElement.innerText = window.reservation.vrijeme_ture + ':00 h';
        timeElement.style.display = "block"; // Show time
        timeElement.style.opacity = 0; // Initially set opacity to 0
        timeElement.style.transition = "opacity 1s ease"; // Smooth transition for opacity
        setTimeout(() => { timeElement.style.opacity = 1; }, 600); // Fade in the time

        guideElement.innerText = window.selectedGuide ? window.selectedGuide.imePrezime : '';
        guideElement.style.display = "block"; // Show guide
        guideElement.style.opacity = 0; // Initially set opacity to 0
        guideElement.style.transition = "opacity 1s ease"; // Smooth transition for opacity
        setTimeout(() => { guideElement.style.opacity = 1; }, 800); // Fade in the guide

        animalElement.innerText = window.selectedAnimal
            ? window.selectedAnimal.vrsta + ' ' + window.selectedAnimal.ime
            : '';
        animalElement.style.display = "block"; // Show animal
        animalElement.style.opacity = 0; // Initially set opacity to 0
        animalElement.style.transition = "opacity 1s ease"; // Smooth transition for opacity
        setTimeout(() => { animalElement.style.opacity = 1; }, 1000); // Fade in the animal

        priceElement.innerText = window.reservation.cijena_ture + '€';
        priceElement.style.display = "block"; // Show price
        priceElement.style.opacity = 0; // Initially set opacity to 0
        priceElement.style.transition = "opacity 1s ease"; // Smooth transition for opacity
        setTimeout(() => { priceElement.style.opacity = 1; }, 1200); // Fade in the price
    }, 200); // Slight delay before showing each element

    // Show the button container with fade-in effect
    setTimeout(() => {
        btnContainer.style.display = 'block'; // Make button container visible
        btnContainer.style.opacity = 0; // Initially set opacity to 0
        btnContainer.style.transition = 'opacity 1s ease'; // Apply transition effect for opacity
        setTimeout(() => {
            btnContainer.style.opacity = 1; // Fade in the button container
        }, 10); // Small delay to apply transition
    }, 1500); // Delay showing the button container after content has faded in
}



        async function fetchTours() {
            // Fetch tours based on tourLength and populate buttons
            const tours = await service.getTuraAll(); // Fetch all tours
            const filteredTours = tours.filter(tour => tour.duljina.duljina === window.tourLength); // Filter by selected length

            const turaButtonsDiv = document.getElementById('tura-buttons');
            turaButtonsDiv.innerHTML = ''; // Clear previous buttons

            filteredTours.forEach(tour => {
                const button = document.createElement('button');
                button.className = 'tura-btn';
                button.innerText = tour.ime; // Set button text to tour name
                button.onclick = () => selectTour(tour); // Attach click handler
                turaButtonsDiv.appendChild(button); // Append button to the div
            });

            // Check if buttons were added
            if (filteredTours.length === 0) {
                turaButtonsDiv.innerHTML = '<p>No tours available for the selected length.</p>';
            }
        }

        function selectTour(tour) {
            window.selectedOption = tour;

            const descriptionDiv = document.getElementById('tura-description');
            const imageDiv = document.getElementById('tura-image');
            const nameElement = document.getElementById('tura-name');
            const descriptionElement = document.getElementById('tura-description-text');

            console.log(window.selectedOption);

            imageDiv.style.display = "none";
            nameElement.style.display = "none";
            descriptionElement.style.display = "none";

            // Populate the image
            setTimeout(() => {
                
                imageDiv.style.display = "block"; // Display the image container
                imageDiv.style.opacity = 0; // Initially set opacity to 0 for fade-in effect
                imageDiv.style.transition = "opacity 1s ease"; // Smooth fade-in transition for image

                // Set the image source
                imageDiv.src = "imgs/reservation/tura/tura_imgs/" + tour.id + ".jpg";

                // Trigger the fade-in effect after a delay
                setTimeout(() => {
                    imageDiv.style.opacity = 1; // Fade in the image by changing opacity
                }, 10); // Small delay to apply the transition
            }, 200); // Delay before showing the image

            // Populate the tour details (name and description)
            setTimeout(() => {
                
                // Add inline CSS for smooth fade-in transition for name and description
                nameElement.style.display = "block";
                nameElement.style.opacity = 0;
                nameElement.style.transition = "opacity 1s ease"; // Fade-in for name

                descriptionElement.style.display = "block";
                descriptionElement.style.opacity = 0;
                descriptionElement.style.transition = "opacity 1s ease"; // Fade-in for description

                // Set the content for name and description
                nameElement.innerHTML = `<strong>${tour.ime}</strong>`;
                descriptionElement.innerHTML = `<p>${tour.opis}</p>`;

                // Trigger the fade-in effect after a delay
                setTimeout(() => {
                    nameElement.style.opacity = 1; // Fade in name
                }, 10); // Small delay to apply transition

                setTimeout(() => {
                    descriptionElement.style.opacity = 1; // Fade in description
                }, 300); // Delay description fade-in after name
            }, 700);
            
            // Show next button
            setTimeout(() => {
                document.getElementById('next-btn').style.display = "block";
                document.getElementById('next-btn').style.opacity = 0; // Initially set opacity to 0 for fade-in effect
                document.getElementById('next-btn').style.transition = "opacity 1s ease"; // Smooth fade-in transition for imag
    
                // Trigger the fade-in effect after a delay
                setTimeout(() => {
                    document.getElementById('next-btn').style.opacity = 1; // Fade in the image by changing opacity
                }, 10);
            }, 50); // Show next button
        }


        async function fetchVodici() {
            // Fetch guides and populate buttons
            const vodici = await service.getVodicAll(); // Fetch all guides

            const vodicButtonsDiv = document.getElementById('vodic-buttons');
            vodicButtonsDiv.innerHTML = ''; // Clear previous buttons

            vodici.forEach(vodic => {
                const button = document.createElement('button');
                button.className = 'vodic-btn';
                button.innerText = vodic.imePrezime; // Set button text to guide name
                button.onclick = () => selectVodic(vodic); // Attach click handler
                vodicButtonsDiv.appendChild(button); // Append button to the div
            });

            // Check if buttons were added
            if (vodici.length === 0) {
                vodicButtonsDiv.innerHTML = '<p>No guides available.</p>';
            }
        }

        function selectVodic(vodic) {
            window.selectedOption = vodic;

            const descriptionDiv = document.getElementById('vodic-description');
            const imageDiv = document.getElementById('vodic-image');
            const nameDiv = document.getElementById('vodic-name');
            const brTuraDiv = document.getElementById('vodic-br-tura');
            const brTelDiv = document.getElementById('vodic-tel');
            const descriptionElement = document.getElementById('vodic-description-text');

            console.log(window.selectedOption);

            // Initially hide all elements
            imageDiv.style.display = "none";
            nameDiv.style.display = "none";
            brTuraDiv.style.display = "none";
            brTelDiv.style.display = "none";
            descriptionElement.style.display = "none";

            // Populate the image with fade-in
            setTimeout(() => {
                imageDiv.style.display = "block";
                imageDiv.style.opacity = 0;
                imageDiv.style.transition = "opacity 1s ease";
                imageDiv.src = "imgs/reservation/vodici/vodici_imgs/" + vodic.id + ".jpg"; // Set the image source
                setTimeout(() => {
                    imageDiv.style.opacity = 1;
                }, 10);
            }, 200);

            // Populate the guide details (name, tours, phone, description)
            setTimeout(() => {
                // Add smooth fade-in for name
                nameDiv.style.display = "block";
                nameDiv.style.opacity = 0;
                nameDiv.style.transition = "opacity 1s ease";

                // Add smooth fade-in for number of tours
                brTuraDiv.style.display = "block";
                brTuraDiv.style.opacity = 0;
                brTuraDiv.style.transition = "opacity 1s ease";

                // Add smooth fade-in for phone number
                brTelDiv.style.display = "block";
                brTelDiv.style.opacity = 0;
                brTelDiv.style.transition = "opacity 1s ease";

                // Add smooth fade-in for description
                descriptionElement.style.display = "block";
                descriptionElement.style.opacity = 0;
                descriptionElement.style.transition = "opacity 1s ease";

                // Set content for name, tours, phone, and description
                nameDiv.innerHTML = `<strong>${vodic.imePrezime}</strong>`;
                brTuraDiv.innerHTML = `<strong style="font-size: 1rem; color: #475a8a; opacity: 80%; font-weight: normal;">Broj tura - ${vodic.brojTura}</strong>`;
                brTelDiv.innerHTML = `<strong style="font-size: 1rem; color: #475a8a; opacity: 80%; font-weight: normal;">Br. telefona - ${vodic.broj_telefona}</strong>`;
                descriptionElement.innerHTML = `<p>${vodic.opis}</p>`;

                // Trigger the fade-in effects
                setTimeout(() => {
                    nameDiv.style.opacity = 1;
                }, 10);

                setTimeout(() => {
                    brTuraDiv.style.opacity = 1;
                }, 200);

                setTimeout(() => {
                    brTelDiv.style.opacity = 1;
                }, 400);

                setTimeout(() => {
                    descriptionElement.style.opacity = 1;
                }, 600);
            }, 700);

            // Show next button
            setTimeout(() => {
                document.getElementById('next-btn').style.display = "block";
                document.getElementById('next-btn').style.opacity = 0; // Initially set opacity to 0 for fade-in effect
                document.getElementById('next-btn').style.transition = "opacity 1s ease"; // Smooth fade-in transition for imag
    
                // Trigger the fade-in effect after a delay
                setTimeout(() => {
                    document.getElementById('next-btn').style.opacity = 1; // Fade in the image by changing opacity
                }, 10);
            }, 50); // Show next button
        }


        async function fetchZivotinje() {
            // Fetch animals based on the selected pet type and populate buttons
            const zivotinje = await service.getZivotinjaAll(); // Fetch all animals
            const filteredZivotinje = zivotinje.filter(zivotinja => zivotinja.vrsta === window.selectedPet); // Filter by selected type

            const zivotinjaButtonsDiv = document.getElementById('zivotinja-buttons');
            zivotinjaButtonsDiv.innerHTML = ''; // Clear previous buttons

            filteredZivotinje.forEach(zivotinja => {
                const button = document.createElement('button');
                button.className = 'zivotinja-btn';
                button.innerText = zivotinja.ime; // Set button text to animal name
                button.onclick = () => selectZivotinja(zivotinja); // Attach click handler
                zivotinjaButtonsDiv.appendChild(button); // Append button to the div
            });

            // Check if buttons were added
            if (filteredZivotinje.length === 0) {
                zivotinjaButtonsDiv.innerHTML = '<p>No animals available for the selected type.</p>';
            }
        }

        function selectZivotinja(zivotinja) {
            window.selectedOption = zivotinja;

            const descriptionDiv = document.getElementById('zivotinja-description');
            const imageDiv = document.getElementById('zivotinja-image');
            const nameElement = document.getElementById('zivotinja-name');
            const descriptionElement = document.getElementById('zivotinja-description-text');

            console.log(window.selectedOption);

            // Hide existing elements before showing new content
            imageDiv.style.display = "none";
            nameElement.style.display = "none";
            descriptionElement.style.display = "none";

            // Populate the image
            setTimeout(() => {
                imageDiv.style.display = "block"; // Display the image container
                imageDiv.style.opacity = 0; // Initially set opacity to 0 for fade-in effect
                imageDiv.style.transition = "opacity 1s ease"; // Smooth fade-in transition for image

                // Set the image source
                imageDiv.src = "imgs/reservation/zivotinja/zivotinja_imgs/" + zivotinja.id + ".jpg";

                // Trigger the fade-in effect after a small delay
                setTimeout(() => {
                    imageDiv.style.opacity = 1; // Fade in the image by changing opacity
                }, 10); // Small delay to apply the transition
            }, 200); // Delay before showing the image

            // Populate the animal details (name and description)
            setTimeout(() => {
                // Add inline CSS for smooth fade-in transition for name and description
                nameElement.style.display = "block";
                nameElement.style.opacity = 0;
                nameElement.style.transition = "opacity 1s ease"; // Fade-in for name

                descriptionElement.style.display = "block";
                descriptionElement.style.opacity = 0;
                descriptionElement.style.transition = "opacity 1s ease"; // Fade-in for description

                // Set the content for name and description
                nameElement.innerHTML = `<strong>${zivotinja.ime}</strong>`;
                descriptionElement.innerHTML = `<p>${zivotinja.opis}</p>`;

                // Trigger the fade-in effect after a small delay
                setTimeout(() => {
                    nameElement.style.opacity = 1; // Fade in name
                }, 10); // Small delay to apply transition

                setTimeout(() => {
                    descriptionElement.style.opacity = 1; // Fade in description
                }, 300); // Delay description fade-in after name
            }, 700);

            // Show next button
            setTimeout(() => {
                document.getElementById('next-btn').style.display = "block";
                document.getElementById('next-btn').style.opacity = 0; // Initially set opacity to 0 for fade-in effect
                document.getElementById('next-btn').style.transition = "opacity 1s ease"; // Smooth fade-in transition for imag
    
                // Trigger the fade-in effect after a delay
                setTimeout(() => {
                    document.getElementById('next-btn').style.opacity = 1; // Fade in the image by changing opacity
                }, 10);
            }, 50); // Show next button
        }
        // Set today's date as the minimum selectable date
        function setMinDate() {
            const today = new Date();
            today.setDate(today.getDate() + 1); // Set the date to tomorrow
            const formattedDate = today.toISOString().split('T')[0]; // Format the date as YYYY-MM-DD
            document.getElementById('reservation-date').setAttribute('min', formattedDate); // Set the min attribute to tomorrow's date
        }


        function selectDate() {
            //step4
            const dateInput = document.getElementById('reservation-date');
            const selectedDateDiv = document.getElementById('selected-time-date');

            // Create a Date object from the selected date input
            const date = new Date(dateInput.value);

            selectedDateDiv.innerText = '';
            document.getElementById('next-btn').style.display = "none";

            // Check if the date is valid
            if (!isNaN(date)) {
                // Format the date to the desired format (e.g., "MM/DD/YYYY")
                const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
                selectedDateDiv.innerText = `Datum: ${date.toLocaleDateString('hr-HR', options)}`;
                document.getElementById('placeholder-span').style.display = "none";

                // Show the time selection section
                document.getElementById("time-selection").style.display = "block";

                // Generate time buttons based on the selected date (you would need to implement this function)
                generateTimeButtons(dateInput.value);
            } else {
                selectedDateDiv.innerText = '';
            }
        }

        async function generateTimeButtons(selectedDate) {
            const timeContainer = document.getElementById("time-buttons-container");
            timeContainer.innerHTML = ""; // Clear previous buttons

            let startHour = 9;
            let endHour = 15;
            let interval;

            // Set interval based on tour length
            if (window.tourLength === "Kratka") {
                interval = 1;
            } else if (window.tourLength === "Srednja") {
                interval = 2;
            } else if (window.tourLength === "Duga") {
                interval = 3;
            } else {
                console.error("Invalid tour length");
                return;
            }

            // Get reserved times for the selected date and tour type
            const reservedTimes = await getReservedTimes(selectedDate);
            console.log("Reserved times:", reservedTimes); // Logging for debugging

            // Generate buttons based on the interval
            for (let hour = startHour; hour <= endHour; hour += interval) {
                const timeString = `${hour}:00`;
                const button = document.createElement("button");
                button.type = "button";
                button.className = "time-button";
                button.innerText = timeString;

                // Disable button if time is reserved
                if (reservedTimes.includes(hour)) { // Check if the timeString is in reservedTimes
                    button.disabled = true;
                    button.style.backgroundColor = "gray"; // Gray out the button
                    button.style.color = "white"; // Change text color for better visibility
                } else {
                    button.onclick = () => selectTime(timeString);
                }

                timeContainer.appendChild(button);
            }
        }

        async function getReservedTimes(selectedDate) {
            const zakazane_ture = await service.getZakazaneTureAll(); // Fetch from your database
            console.log("Fetched reserved tours:", zakazane_ture); // Debugging

            const reservedTimes = [];

            // Filter the zakazane_ture to get reserved times for the selected date and tour type
            zakazane_ture.forEach(zt => {
                // Check if the tour ID and date match
                if (zt.tura.id === window.tourId.id && zt.datum === selectedDate) {
                    reservedTimes.push(zt.vrijeme_ture); // Extract reserved time
                    console.log(`Reserved time found: ${zt.vrijeme_ture}`); // Debugging
                }
            });

            // Log the reserved times to verify structure
            console.log("Filtered reserved times:", reservedTimes);
            
            return reservedTimes; // Ensure this returns an array
        }

        function selectTime(time) {
            // Update the displayed selected time step4
            document.getElementById("selected-time-date").innerText += ", Vrijeme: " + time;

            window.selectedTime = time.split(':')[0];
            setTimeout(() => {
                document.getElementById('next-btn').style.display = "block";
                document.getElementById('next-btn').style.opacity = 0; // Initially set opacity to 0 for fade-in effect
                document.getElementById('next-btn').style.transition = "opacity 1s ease"; // Smooth fade-in transition for imag
    
                // Trigger the fade-in effect after a delay
                setTimeout(() => {
                    document.getElementById('next-btn').style.opacity = 1; // Fade in the image by changing opacity
                }, 10);
            }, 50); // Show next button
        }

        function resetForm(){
            location.reload();
        }

        

        document.addEventListener('DOMContentLoaded', function() {
            showButtons(1);
            setMinDate();
        });

        // Make functions available globally
        window.selectOption = selectOption;
        window.nextStep = nextStep;
        window.selectDate = selectDate;
        window.selectTime = selectTime;
        window.saveReservation = saveReservation;
        window.resetForm = resetForm;

        window.addEventListener('beforeunload', function (e) {
            // Display a confirmation dialog (modern browsers override custom messages)
            e.preventDefault(); // This prevents the default action
            e.returnValue = ''; // Required for modern browsers to show a dialog

            // Optionally, display a custom message (most browsers ignore it)
            alert('Osvježavanje stranice će resetirati izabrano. Nastaviti?');
        });


    </script>

</body>
</html>
