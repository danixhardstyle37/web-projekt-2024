<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezervacija</title>
    <link rel="stylesheet" type="text/css" href="styles/rezervacija.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="step-info" id="step-info">Step 1/8</div>
            <button class="next-btn" id="next-btn" onclick="nextStep()">Next</button>
        </div>

        <div class="steps">
            <!-- Step 1 -->
            <div class="step active" id="step1">
                <h1>Veličina grupe</h1>
                <div class="options">
                    <button class="option-btn" id="parovi" onclick="selectOption('Za parove')">Za parove</button>
                    <button class="option-btn" id="grupa" onclick="selectOption('Grupa 3-5')">Grupa 3-5</button>
                    <button class="option-btn" id="teambuilding" onclick="selectOption('Teambuilding')">Teambuilding</button>
                </div>
            </div>

            <!-- Step 2 -->
            <div class="step" id="step2">
                <h1>Duljina ture</h1>
                <div class="options">
                    <button class="option-btn" id="kratka" onclick="selectOption('Kratka')">Kratka</button>
                    <button class="option-btn" id="srednja" onclick="selectOption('Srednja')">Srednja</button>
                    <button class="option-btn" id="duga" onclick="selectOption('Duga')">Duga</button>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="step" id="step3">
                <div class="right">
                    <h1>Ture</h1>
                    <div id="tura-buttons">
                        <!-- Buttons for tours will be dynamically generated here -->
                    </div>
                </div>
                <div class="left">
                    <h1>Informacije o turi</h1>
                    <div class="tura-description" id="tura-description">
                        <!-- Selected tour information will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Step 4 -->
            <div class="step" id="step4">
                <h1>Odaberite datum</h1>
                <input type="date" id="reservation-date" class="date-input" onchange="selectDate()">
                <div id="selected-date" class="selected-date"></div>
            </div>

            <!-- Step 5 -->
            <div class="step" id="step5">
                <div class="right">
                    <h1>Vodici</h1>
                    <div id="vodic-buttons">
                        <!-- Buttons for guides will be dynamically generated here -->
                    </div>
                </div>
                <div class="left">
                    <h1>Informacije o vodicu</h1>
                    <div class="vodic-description" id="vodic-description">
                        <!-- Selected guide information will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Step 6 -->
            <div class="step" id="step6">
                <h1>Odaberite ljubimca</h1>
                <div class="options">
                    <button class="option-btn" id="pas" onclick="selectOption('Pas')">Pas</button>
                    <button class="option-btn" id="svinja" onclick="selectOption('Svinja')">Svinja</button>
                </div>
            </div>

            <!-- Step 7 -->
            <div class="step" id="step7">
                <div class="right">
                    <h1>Životinje</h1>
                    <div id="zivotinja-buttons">
                        <!-- Buttons for animals will be dynamically generated here -->
                    </div>
                </div>
                <div class="left">
                    <h1>Informacije o životinji</h1>
                    <div class="zivotinja-description" id="zivotinja-description">
                        <!-- Selected animal information will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Step 8 -->
            <div class="step" id="step8">
                <h1>Pregled rezervacije</h1>
                <div id="summary" class="summary">
                    <p><strong>Veličina grupe:</strong> <span id="summary-group-size"></span></p>
                    <p><strong>Tura:</strong> <span id="summary-tour"></span></p>
                    <p><strong>Datum rezervacije:</strong> <span id="summary-date"></span></p>
                    <p><strong>Vodic:</strong> <span id="summary-guide"></span></p>
                    <p><strong>Životinja:</strong> <span id="summary-animal"></span></p>
                </div>
                <button class="save-btn" id="save-btn" onclick="saveReservation()">Save Reservation</button>
            </div>

        </div>
    </div>

    <script type="module">
        import service from './scripts/service.js'; 

        window.currentStep = 1;
        const totalSteps = 8;
        window.selectedOption = '';
        window.groupSize = '';
        window.tourLength = '';
        window.tourId = 0;
        window.selectedDate = ''; // Initialize variable to store selected date
        window.selectedGuide = ''; // Initialize variable to store selected guide
        window.selectedPet = ''; // Initialize variable to store selected pet

        function showButtons(step) {
            if (step === 1) {
                setTimeout(() => document.getElementById('parovi').classList.add('visible'), 1000);
                setTimeout(() => document.getElementById('grupa').classList.add('visible'), 2000);
                setTimeout(() => document.getElementById('teambuilding').classList.add('visible'), 3000);
            } else if (step === 2) {
                setTimeout(() => document.getElementById('kratka').classList.add('visible'), 1000);
                setTimeout(() => document.getElementById('srednja').classList.add('visible'), 2000);
                setTimeout(() => document.getElementById('duga').classList.add('visible'), 3000);
            } else if (step === 3) {
                fetchTours(); // Call function to fetch tours on step 3
            } else if (step === 4) {
                // Any additional logic for step 4 if needed
            } else if (step === 5) {
                fetchVodici(); // Fetch guides on step 5
            } else if (step === 6) {
                // Show buttons for selecting pets in Step 6
                setTimeout(() => document.getElementById('pas').classList.add('visible'), 1000);
                setTimeout(() => document.getElementById('svinja').classList.add('visible'), 2000);
            }else if (step === 7) {
                fetchZivotinje(); // Fetch animals on step 7
            }
        }

        function selectOption(option) {
            document.querySelectorAll('.option-btn').forEach(function(button) {
                button.classList.remove('selected');
            });
            document.querySelector(`.option-btn[onclick="selectOption('${option}')"]`).classList.add('selected');

            window.selectedOption = option;
            document.getElementById('next-btn').style.display = 'block'; // Show Next button
        }

        function nextStep() {
            if (window.selectedOption || window.currentStep === 4 || window.currentStep === 5 || window.currentStep === 6) { // Allow moving to step 4, 5, and 6 without selection
                document.getElementById('next-btn').style.display = 'none';

                
                switch (window.currentStep) {
                    case 1:
                        window.groupSize = window.selectedOption;
                        break;
                    case 2:
                        window.tourLength = window.selectedOption;
                        break;
                    case 3:
                        window.tourId = window.selectedOption.id;
                        break;
                    case 4:
                        window.selectedDate = document.getElementById('reservation-date').value;
                        break;
                    case 5:
                        window.selectedGuide = window.selectedOption;
                        break;
                    case 6:
                        window.selectedPet = window.selectedOption;
                        break;
                    case 7:
                        window.selectedAnimal = window.selectedOption;
                        break;
                    case 8:
                        // Here we update the summary display
                        document.getElementById('summary-group-size').innerText = window.groupSize;
                        document.getElementById('summary-tour').innerText = window.selectedOption ? window.selectedOption.ime : ''; // Ensure you get the name of the selected tour
                        document.getElementById('summary-date').innerText = window.selectedDate;
                        document.getElementById('summary-guide').innerText = window.selectedGuide ? window.selectedGuide.imePrezime : ''
                        document.getElementById('summary-animal').innerText = window.selectedAnimal ? window.selectedAnimal.ime : '';
                        break;
                    default:
                        console.log("Error");
                }

                console.log(window.selectedOption);
                window.selectedOption = '';

                // Hide all option buttons
                document.querySelectorAll('.option-btn').forEach(function(button) {
                    button.classList.remove('visible');
                });

                const currentStepElement = document.getElementById(`step${window.currentStep}`);
                currentStepElement.classList.remove('active');

                window.currentStep++;
                const nextStepElement = document.getElementById(`step${window.currentStep}`);
                nextStepElement.classList.add('active');

                document.getElementById('step-info').innerText = `Step ${window.currentStep}/8`;

                // Show buttons for the next step
                showButtons(window.currentStep);
            }
        }

        function saveReservation() {
            // Logic to save the reservation can be implemented here
            alert("Reservation saved successfully!"); // Placeholder alert for now
        }

        async function fetchTours() {
            // Fetch tours based on tourLength and populate buttons
            const tours = await service.getTuraAll(); // Fetch all tours
            const filteredTours = tours.filter(tour => tour.duljina.duljina === window.tourLength); // Filter by selected length

            const turaButtonsDiv = document.getElementById('tura-buttons');
            turaButtonsDiv.innerHTML = ''; // Clear previous buttons

            filteredTours.forEach(tour => {
                const button = document.createElement('button');
                button.className = 'tura-btn';
                button.innerText = tour.ime; // Set button text to tour name
                button.onclick = () => selectTour(tour); // Attach click handler
                turaButtonsDiv.appendChild(button); // Append button to the div
            });

            // Check if buttons were added
            if (filteredTours.length === 0) {
                turaButtonsDiv.innerHTML = '<p>No tours available for the selected length.</p>';
            }
        }

        function selectTour(tour) {
            window.selectedOption = tour;
            const descriptionDiv = document.getElementById('tura-description');
            descriptionDiv.innerHTML = `<strong>${tour.ime}</strong><p>${tour.opis}</p>`;
            document.getElementById('next-btn').style.display = 'block'; // Show next button
        }

        async function fetchVodici() {
            // Fetch guides and populate buttons
            const vodici = await service.getVodicAll(); // Fetch all guides

            const vodicButtonsDiv = document.getElementById('vodic-buttons');
            vodicButtonsDiv.innerHTML = ''; // Clear previous buttons

            vodici.forEach(vodic => {
                const button = document.createElement('button');
                button.className = 'vodic-btn';
                button.innerText = vodic.imePrezime; // Set button text to guide name
                button.onclick = () => selectVodic(vodic); // Attach click handler
                vodicButtonsDiv.appendChild(button); // Append button to the div
            });

            // Check if buttons were added
            if (vodici.length === 0) {
                vodicButtonsDiv.innerHTML = '<p>No guides available.</p>';
            }
        }

        function selectVodic(vodic) {
            window.selectedOption = vodic;
            const descriptionDiv = document.getElementById('vodic-description');
            descriptionDiv.innerHTML = `<strong>${vodic.imePrezime}</strong><strong>${vodic.brojTura}</strong><p>${vodic.opis}</p>`;
            document.getElementById('next-btn').style.display = 'block'; // Show next button
        }

        async function fetchZivotinje() {
            // Fetch animals based on the selected pet type and populate buttons
            const zivotinje = await service.getZivotinjaAll(); // Fetch all animals
            const filteredZivotinje = zivotinje.filter(zivotinja => zivotinja.vrsta === window.selectedPet); // Filter by selected type

            const zivotinjaButtonsDiv = document.getElementById('zivotinja-buttons');
            zivotinjaButtonsDiv.innerHTML = ''; // Clear previous buttons

            filteredZivotinje.forEach(zivotinja => {
                const button = document.createElement('button');
                button.className = 'zivotinja-btn';
                button.innerText = zivotinja.ime; // Set button text to animal name
                button.onclick = () => selectZivotinja(zivotinja); // Attach click handler
                zivotinjaButtonsDiv.appendChild(button); // Append button to the div
            });

            // Check if buttons were added
            if (filteredZivotinje.length === 0) {
                zivotinjaButtonsDiv.innerHTML = '<p>No animals available for the selected type.</p>';
            }
        }

        function selectZivotinja(zivotinja) {
            window.selectedOption = zivotinja;
            const descriptionDiv = document.getElementById('zivotinja-description');
            descriptionDiv.innerHTML = `<strong>${zivotinja.ime}</strong><p>${zivotinja.opis}</p>`;
            document.getElementById('next-btn').style.display = 'block'; // Show next button
        }

        function selectDate() {
            const dateInput = document.getElementById('reservation-date');
            const selectedDateDiv = document.getElementById('selected-date');
            
            const date = new Date(dateInput.value);
            if (!isNaN(date)) {
                const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
                selectedDateDiv.innerText = `Odabrani datum: ${date.toLocaleDateString('en-US', options)}`;
                document.getElementById('next-btn').style.display = 'block'; // Show next button
            } else {
                selectedDateDiv.innerText = '';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            showButtons(1);
        });

        // Make functions available globally
        window.selectOption = selectOption;
        window.nextStep = nextStep;
        window.selectDate = selectDate;

    </script>

</body>
</html>
